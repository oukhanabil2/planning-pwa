<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Superviseur Planning</title>
    
    <!-- CONFIGURATION PWA -->
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#2c3e50">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- STYLES -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* STYLES DE BASE */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #1a1a2e;
            color: #fff;
            min-height: 100vh;
        }
        
        /* HEADER */
        .app-header {
            background: #2c3e50;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .app-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .app-title i {
            color: #4361ee;
            font-size: 1.5rem;
        }
        
        .header-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        /* BOUTON INSTALLATION */
        .install-btn {
            background: #4361ee;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            display: none;
        }
        
        /* LAYOUT */
        .app-container {
            display: flex;
            min-height: calc(100vh - 70px);
        }
        
        /* SIDEBAR */
        .sidebar {
            width: 280px;
            background: rgba(255, 255, 255, 0.05);
            border-right: 1px solid rgba(255,255,255,0.1);
            padding: 20px 0;
            display: flex;
            flex-direction: column;
        }
        
        .user-info {
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px;
        }
        
        .user-info i {
            font-size: 2.5rem;
            color: #4361ee;
            margin-bottom: 10px;
        }
        
        .user-info h3 {
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .connection-status {
            font-size: 0.85rem;
            color: #2ecc71;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* MENU */
        .menu {
            list-style: none;
            flex-grow: 1;
        }
        
        .menu-item {
            padding: 15px 25px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid transparent;
        }
        
        .menu-item:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .menu-item.active {
            background: rgba(67, 97, 238, 0.2);
            border-left-color: #4361ee;
            font-weight: 600;
        }
        
        .menu-item i {
            width: 20px;
            text-align: center;
            font-size: 1.1rem;
        }
        
        /* CONTENU PRINCIPAL */
        .main-content {
            flex-grow: 1;
            padding: 25px;
            overflow-y: auto;
        }
        
        .page-header {
            margin-bottom: 30px;
        }
        
        .page-header h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            color: #4361ee;
        }
        
        /* CARTE D'ACCUEIL */
        .welcome-card {
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .welcome-card h2 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .welcome-card p {
            color: #ccc;
            line-height: 1.6;
            margin-bottom: 25px;
        }
        
        /* STATUT PWA */
        .pwa-status {
            background: rgba(0,0,0,0.2);
            border-radius: 15px;
            padding: 20px;
            margin: 25px 0;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
        }
        
        .status-item:last-child {
            margin-bottom: 0;
        }
        
        .status-item i {
            font-size: 1.2rem;
        }
        
        /* INSTRUCTIONS */
        .instructions {
            background: rgba(67, 97, 238, 0.1);
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            border-left: 4px solid #4361ee;
        }
        
        .instructions h3 {
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .instructions ol {
            padding-left: 20px;
            margin-bottom: 0;
        }
        
        .instructions li {
            margin-bottom: 10px;
            line-height: 1.5;
        }
        
        /* BOUTONS */
        .btn-primary {
            background: #4361ee;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }
        
        .btn-primary:hover {
            background: #3a56d4;
        }
        
        /* FOOTER */
        .app-footer {
            padding: 15px 25px;
            background: rgba(255,255,255,0.05);
            border-top: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
            color: #aaa;
        }
        
        /* RESPONSIVE */
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                order: 2;
            }
            
            .main-content {
                order: 1;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- HEADER -->
    <header class="app-header">
        <div class="app-title">
            <i class="fas fa-calendar-alt"></i>
            <span>SUPERVISEUR PLANNING</span>
        </div>
        <div class="header-actions">
            <button id="installBtn" class="install-btn">
                <i class="fas fa-download"></i>
                <span>INSTALLER</span>
            </button>
            <div class="connection-status" id="connectionStatus">
                <i class="fas fa-circle"></i>
                <span>Chargement...</span>
            </div>
        </div>
    </header>

    <!-- CONTENU PRINCIPAL -->
    <div class="app-container">
        <!-- SIDEBAR -->
        <nav class="sidebar">
            <div class="user-info">
                <i class="fas fa-user-circle"></i>
                <h3>Superviseur</h3>
                <div class="connection-status">
                    <i class="fas fa-wifi" id="wifiIcon"></i>
                    <span id="networkStatus">V√©rification...</span>
                </div>
            </div>
            
            <ul class="menu">
                <li class="menu-item active" data-page="dashboard">
                    <i class="fas fa-home"></i>
                    <span>Tableau de bord</span>
                </li>
                <li class="menu-item" data-page="planning">
                    <i class="fas fa-calendar-week"></i>
                    <span>Planning</span>
                </li>
                <li class="menu-item" data-page="agents">
                    <i class="fas fa-users"></i>
                    <span>Agents</span>
                </li>
                <li class="menu-item" data-page="statistics">
                    <i class="fas fa-chart-bar"></i>
                    <span>Statistiques</span>
                </li>
                <li class="menu-item" data-page="conges">
                    <i class="fas fa-umbrella-beach"></i>
                    <span>Cong√©s</span>
                </li>
                <li class="menu-item" data-page="equipment">
                    <i class="fas fa-walkie-talkie"></i>
                    <span>√âquipement</span>
                </li>
                <li class="menu-item" data-page="import">
                    <i class="fas fa-file-import"></i>
                    <span>Import Excel</span>
                </li>
                <li class="menu-item" data-page="settings">
                    <i class="fas fa-cog"></i>
                    <span>Param√®tres</span>
                </li>
            </ul>
            
            <div class="app-footer">
                <div>
                    <i class="fas fa-database"></i>
                    <span id="dbSize">0 KB</span>
                </div>
                <div id="swStatus">
                    <i class="fas fa-sync"></i>
                    <span>Service Worker...</span>
                </div>
            </div>
        </nav>

        <!-- CONTENU DYNAMIQUE -->
        <main class="main-content">
            <div class="page-header">
                <h1 id="pageTitle">Tableau de bord</h1>
                <div class="breadcrumb">
                    <span>Superviseur Planning PWA</span>
                </div>
            </div>
            
            <div id="pageContent">
                <div class="welcome-card">
                    <h2>
                        <i class="fas fa-check-circle" style="color:#2ecc71"></i>
                        PWA PR√äTE √Ä L'INSTALLATION
                    </h2>
                    
                    <p>Votre application de gestion de planning est maintenant configur√©e comme Progressive Web App et peut √™tre install√©e sur votre √©cran d'accueil.</p>
                    
                    <div class="pwa-status">
                        <div class="status-item" id="statusSw">
                            <i class="fas fa-sync fa-spin"></i>
                            <span>Service Worker : <strong>V√©rification...</strong></span>
                        </div>
                        <div class="status-item">
                            <i class="fas fa-check-circle"></i>
                            <span>Manifest : <strong>‚úì Configur√©</strong></span>
                        </div>
                        <div class="status-item">
                            <i class="fas fa-check-circle"></i>
                            <span>HTTPS/HTTP : <strong>Local (OK)</strong></span>
                        </div>
                        <div class="status-item" id="statusPwa">
                            <i class="fas fa-mobile-alt"></i>
                            <span>Installation PWA : <strong>En attente...</strong></span>
                        </div>
                    </div>
                    
                    <div class="instructions">
                        <h3><i class="fas fa-mobile-alt"></i> POUR INSTALLER L'APPLICATION :</h3>
                        <ol>
                            <li><strong>Utilisez l'application 30 secondes</strong> (cliquez sur quelques menus)</li>
                            <li>Appuyez sur <strong>‚ãÆ</strong> (menu Chrome en haut √† droite)</li>
                            <li>S√©lectionnez <strong>"Ajouter √† l'√©cran d'accueil"</strong></li>
                            <li>Confirmez en cliquant sur <strong>"Ajouter"</strong></li>
                        </ol>
                        <p style="margin-top: 15px; font-style: italic; color: #aaa;">
                            Une ic√¥ne appara√Ætra sur votre √©cran d'accueil comme une application native.
                        </p>
                    </div>
                    
                    <div style="text-align: center; margin-top: 30px;">
                        <button id="testBtn" class="btn-primary">
                            <i class="fas fa-bolt"></i>
                            <span>TESTS AUTOMATIQUES</span>
                        </button>
                        <button id="manualInstallBtn" class="btn-primary" style="background: #27ae60; margin-left: 15px;">
                            <i class="fas fa-external-link-alt"></i>
                            <span>FORCER L'INSTALLATION</span>
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

<!-- ===== SCRIPT PWA SIMPLIFI√â POUR FICHIERS LOCAUX ===== -->
<script>
// === VARIABLES GLOBALES ===
let deferredPrompt = null;
let swRegistered = false;

// === SERVICE WORKER LOCAL ===
function registerServiceWorkerLocal() {
    console.log('üîß Enregistrement Service Worker...');
    
    if (!('serviceWorker' in navigator)) {
        console.log('‚ö†Ô∏è Service Worker non support√©');
        updateStatus('statusSw', '‚ùå Non support√©');
        return;
    }
    
    // Essayer plusieurs chemins
    const swPaths = [
        'service-worker.js',
        './service-worker.js'
    ];
    
    for (const path of swPaths) {
        navigator.serviceWorker.register(path, { scope: './' })
        .then(registration => {
            console.log('‚úÖ Service Worker enregistr√©:', path);
            swRegistered = true;
            updateStatus('statusSw', '‚úÖ Actif');
            
            // V√©rifier l'√©tat
            if (registration.active) {
                console.log('üöÄ Service Worker actif!');
            }
        })
        .catch(err => {
            console.log(`‚ùå √âchec ${path}:`, err.message);
            if (path === swPaths[swPaths.length - 1]) {
                updateStatus('statusSw', '‚ö†Ô∏è Mode local');
            }
        });
    }
}

// === INSTALLATION PWA ===
function setupPWA() {
    window.addEventListener('beforeinstallprompt', (e) => {
        console.log('üéØ PWA pr√™te √† installer!');
        e.preventDefault();
        deferredPrompt = e;
        
        // Afficher bouton
        const installBtn = document.getElementById('installBtn');
        if (installBtn) {
            installBtn.style.display = 'flex';
            installBtn.onclick = () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then(choice => {
                        if (choice.outcome === 'accepted') {
                            console.log('‚úÖ Utilisateur a install√©');
                            showToast('Application install√©e!', 'success');
                        }
                        deferredPrompt = null;
                        installBtn.style.display = 'none';
                    });
                }
            };
        }
        
        updateStatus('statusPwa', '‚úÖ Disponible');
        showToast('Application pr√™te √† √™tre install√©e', 'success');
    });
    
    // V√©rifier si d√©j√† install√©e
    if (window.matchMedia('(display-mode: standalone)').matches) {
        console.log('üì± D√©j√† install√©e');
        updateStatus('statusPwa', '‚úÖ D√©j√† install√©e');
    }
    
    window.addEventListener('appinstalled', () => {
        console.log('üéâ Application install√©e!');
        updateStatus('statusPwa', '‚úÖ Install√©e');
        showToast('Installation r√©ussie!', 'success');
    });
}

// === FONCTIONS UTILITAIRES ===
function updateStatus(elementId, text) {
    const el = document.getElementById(elementId);
    if (el) {
        const strong = el.querySelector('strong');
        if (strong) {
            strong.innerHTML = text;
        }
        
        // Mettre √† jour l'ic√¥ne
        const icon = el.querySelector('i');
        if (icon) {
            if (text.includes('‚úÖ')) {
                icon.className = 'fas fa-check-circle';
                icon.style.color = '#2ecc71';
            } else if (text.includes('‚ö†Ô∏è')) {
                icon.className = 'fas fa-exclamation-triangle';
                icon.style.color = '#f39c12';
            } else if (text.includes('‚ùå')) {
                icon.className = 'fas fa-times-circle';
                icon.style.color = '#e74c3c';
            } else if (text.includes('Actif')) {
                icon.className = 'fas fa-check-circle';
                icon.style.color = '#2ecc71';
            }
        }
    }
}

function showToast(message, type = 'info') {
    console.log(`üì¢ ${type}: ${message}`);
    
    // Cr√©er un toast simple
    const toast = document.createElement('div');
    toast.style.cssText = `
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: ${type === 'success' ? '#27ae60' : type === 'error' ? '#e74c3c' : '#3498db'};
        color: white;
        padding: 12px 24px;
        border-radius: 50px;
        z-index: 10000;
        font-weight: bold;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        animation: toastSlide 0.3s ease;
    `;
    
    toast.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation' : 'info'}-circle"></i>
        ${message}
    `;
    
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transform = 'translateX(-50%) translateY(100px)';
        setTimeout(() => toast.remove(), 300);
    }, 3000);
}

// === SIMULATION USAGE ===
function simulateUsage() {
    console.log('üîÑ Simulation d\'usage...');
    
    const menus = document.querySelectorAll('.menu-item');
    let current = 0;
    
    const interval = setInterval(() => {
        menus.forEach(m => m.classList.remove('active'));
        menus[current].classList.add('active');
        
        current = (current + 1) % menus.length;
        
        if (current === 0) {
            clearInterval(interval);
            showToast('‚úÖ Simulation termin√©e. V√©rifiez le menu Chrome (‚ãÆ)', 'success');
            
            // V√©rifier si PWA disponible
            if (deferredPrompt) {
                setTimeout(() => {
                    showToast('üéØ PWA PR√äTE ! V√©rifiez le menu Chrome (‚ãÆ)', 'success', 5000);
                }, 1000);
            }
        }
    }, 1000);
}

// === GESTION MENU ===
function setupMenu() {
    const menuItems = document.querySelectorAll('.menu-item');
    menuItems.forEach(item => {
        item.addEventListener('click', function() {
            menuItems.forEach(i => i.classList.remove('active'));
            this.classList.add('active');
            
            const pageName = this.querySelector('span').textContent;
            document.getElementById('pageTitle').textContent = pageName;
            
            showToast(`Chargement: ${pageName}`, 'info');
        });
    });
}

// === GESTION R√âSEAU ===
function updateNetworkStatus() {
    const isOnline = navigator.onLine;
    const statusEl = document.getElementById('connectionStatus');
    const networkEl = document.getElementById('networkStatus');
    const wifiIcon = document.getElementById('wifiIcon');
    
    if (statusEl) {
        statusEl.innerHTML = `
            <i class="fas fa-circle" style="color:${isOnline ? '#2ecc71' : '#e74c3c'}"></i>
            <span>${isOnline ? 'En ligne' : 'Hors ligne'}</span>
        `;
    }
    
    if (networkEl) {
        networkEl.textContent = isOnline ? 'En ligne' : 'Hors ligne';
    }
    
    if (wifiIcon) {
        wifiIcon.className = isOnline ? 'fas fa-wifi' : 'fas fa-wifi-slash';
        wifiIcon.style.color = isOnline ? '#2ecc71' : '#e74c3c';
    }
}

// === INITIALISATION ===
document.addEventListener('DOMContentLoaded', () => {
    console.log('üöÄ Initialisation application...');
    
    // Configurer menu
    setupMenu();
    
    // Configurer r√©seau
    updateNetworkStatus();
    window.addEventListener('online', updateNetworkStatus);
    window.addEventListener('offline', updateNetworkStatus);
    
    // Service Worker
    setTimeout(() => {
        registerServiceWorkerLocal();
    }, 1000);
    
    // Configurer PWA
    setupPWA();
    
    // Configurer boutons
    const testBtn = document.getElementById('testBtn');
    if (testBtn) {
        testBtn.onclick = simulateUsage;
    }
    
    const manualBtn = document.getElementById('manualInstallBtn');
    if (manualBtn) {
        manualBtn.onclick = () => {
            showToast('Pour installer: Menu Chrome (‚ãÆ) ‚Üí "Ajouter √† l\'√©cran d\'accueil"', 'info', 5000);
        };
    }
    
    // Message d'aide
    setTimeout(() => {
        if (deferredPrompt) {
            showToast('üéØ PWA PR√äTE ! Utilisez l\'app puis menu Chrome (‚ãÆ)', 'success', 5000);
        } else {
            showToast('Utilisez l\'application pour activer l\'installation', 'info');
        }
    }, 5000);
});

// === STYLE ANIMATION ===
const style = document.createElement('style');
style.textContent = `
    @keyframes toastSlide {
        from { transform: translateX(-50%) translateY(100px); opacity: 0; }
        to { transform: translateX(-50%) translateY(0); opacity: 1; }
    }
    
    .fa-spin {
        animation: fa-spin 1s infinite linear;
    }
    
    @keyframes fa-spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
`;
document.head.appendChild(style);
</script>
    <script>
// Script d'activation PWA pour GitHub Pages
console.log('üöÄ PWA GitHub Pages activ√©e');

// D√©tection installation
let installPrompt = null;

window.addEventListener('beforeinstallprompt', (e) => {
    console.log('‚úÖ PWA installable d√©tect√©e!');
    e.preventDefault();
    installPrompt = e;
    
    // Afficher un bouton d'installation
    const installBtn = document.createElement('button');
    installBtn.innerHTML = 'üì± INSTALLER L\'APP';
    installBtn.style.cssText = `
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: #27ae60;
        color: white;
        border: none;
        padding: 15px 25px;
        border-radius: 50px;
        font-weight: bold;
        box-shadow: 0 4px 15px rgba(39, 174, 96, 0.4);
        z-index: 9999;
    `;
    
    installBtn.onclick = () => {
        if (installPrompt) {
            installPrompt.prompt();
            installPrompt.userChoice.then(choice => {
                if (choice.outcome === 'accepted') {
                    alert('üéâ Application install√©e avec succ√®s!');
                }
                installPrompt = null;
                installBtn.remove();
            });
        }
    };
    
    document.body.appendChild(installBtn);
    
    // Message d'info
    alert('üì± PWA PR√äTE !\n\nL\'application peut √™tre install√©e.\nUtilisez l\'app 30 secondes ou cliquez sur le bouton vert.');
});

// V√©rifier si d√©j√† install√©e
if (window.matchMedia('(display-mode: standalone)').matches) {
    console.log('‚úÖ D√©j√† install√©e en mode standalone');
}
</script>
</body>
</html>
